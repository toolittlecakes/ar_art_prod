<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>AR Fox Model with Marker</title>
  <meta name="description" content="Simple AR application displaying a low poly fox 3D model over a Hiro marker">

  <!-- A-Frame library -->
  <script src="https://aframe.io/releases/1.6.0/aframe.min.js"></script>
  <!-- Use marker-only AR.js (without NFT/location features that may use gyroscope) -->
  <script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar.js"></script>

  <style>
    body {
      margin: 0;
      overflow: hidden;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    }

    /* Loading overlay */
    #loading-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.85);
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      z-index: 9999;
      transition: opacity 0.5s ease-out;
    }

    #loading-overlay.hidden {
      opacity: 0;
      pointer-events: none;
    }

    .loading-content {
      text-align: center;
      color: white;
    }

    .loading-title {
      font-size: 1.5rem;
      font-weight: 300;
      margin-bottom: 30px;
      letter-spacing: 2px;
      text-transform: uppercase;
    }

    .loading-spinner {
      width: 50px;
      height: 50px;
      border: 3px solid rgba(255, 255, 255, 0.1);
      border-top-color: #00d4ff;
      border-radius: 50%;
      animation: spin 1s linear infinite;
      margin-bottom: 25px;
    }

    @keyframes spin {
      to {
        transform: rotate(360deg);
      }
    }

    /* –ü–ª–∞—à–∫–∞ "–ü–æ–π–º–∞–π –º–µ–Ω—è" */
    #catch-banner {
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      background: linear-gradient(135deg, #ff6b6b 0%, #ee5a24 50%, #f0932b 100%);
      color: white;
      text-align: center;
      padding: 20px 30px;
      font-size: 1.4rem;
      font-weight: 600;
      letter-spacing: 3px;
      text-transform: uppercase;
      z-index: 1000;
      transform: translateY(100%);
      transition: transform 0.4s cubic-bezier(0.68, -0.55, 0.265, 1.55);
      box-shadow: 0 -4px 20px rgba(0, 0, 0, 0.3);
      cursor: pointer;
      user-select: none;
    }

    #catch-banner.visible {
      transform: translateY(0);
    }

    #catch-banner::before {
      content: 'üëÜ';
      margin-right: 12px;
      font-size: 1.2rem;
    }

    #catch-banner::after {
      content: 'üëÜ';
      margin-left: 12px;
      font-size: 1.2rem;
    }

    /* –ü—É–ª—å—Å–∞—Ü–∏—è –∫–æ–≥–¥–∞ –∞–∫—Ç–∏–≤–Ω–∞ */
    #catch-banner.visible {
      animation: pulse-banner 1.5s ease-in-out infinite;
    }

    @keyframes pulse-banner {

      0%,
      100% {
        box-shadow: 0 -4px 20px rgba(0, 0, 0, 0.3);
      }

      50% {
        box-shadow: 0 -4px 30px rgba(255, 107, 107, 0.6);
      }
    }

    /* –ü–ª–∞—à–∫–∞ "–ù–∞—á–∞—Ç—å" –¥–ª—è –ø–µ—Ä–≤–æ–≥–æ –∑–∞–ø—É—Å–∫–∞ */
    #start-banner {
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      text-align: center;
      padding: 22px 30px;
      font-size: 1.4rem;
      font-weight: 600;
      letter-spacing: 3px;
      text-transform: uppercase;
      z-index: 1000;
      transform: translateY(100%);
      transition: transform 0.4s cubic-bezier(0.68, -0.55, 0.265, 1.55);
      box-shadow: 0 -4px 20px rgba(102, 126, 234, 0.4);
      cursor: pointer;
      user-select: none;
    }

    #start-banner.visible {
      transform: translateY(0);
      animation: pulse-start 1.5s ease-in-out infinite;
    }

    #start-banner::before {
      content: '‚ñ∂Ô∏è';
      margin-right: 12px;
      font-size: 1.2rem;
    }

    @keyframes pulse-start {

      0%,
      100% {
        box-shadow: 0 -4px 20px rgba(102, 126, 234, 0.4);
      }

      50% {
        box-shadow: 0 -4px 35px rgba(102, 126, 234, 0.7);
      }
    }

    /* –û–Ω–±–æ—Ä–¥–∏–Ω–≥ —ç–∫—Ä–∞–Ω */
    #onboarding-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      z-index: 10000;
      transition: opacity 0.5s ease-out;
      padding: 30px;
      box-sizing: border-box;
    }

    #onboarding-overlay.hidden {
      opacity: 0;
      pointer-events: none;
    }

    .onboarding-content {
      text-align: center;
      color: white;
      max-width: 400px;
    }

    .onboarding-icon {
      font-size: 4rem;
      margin-bottom: 25px;
      animation: float 3s ease-in-out infinite;
    }

    @keyframes float {

      0%,
      100% {
        transform: translateY(0);
      }

      50% {
        transform: translateY(-10px);
      }
    }

    .onboarding-title {
      font-size: 1.6rem;
      font-weight: 600;
      margin-bottom: 20px;
      letter-spacing: 1px;
      line-height: 1.4;
    }

    .onboarding-description {
      font-size: 1.1rem;
      font-weight: 300;
      margin-bottom: 35px;
      line-height: 1.6;
      opacity: 0.9;
    }

    .onboarding-tip {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 12px;
      background: rgba(255, 255, 255, 0.1);
      padding: 15px 25px;
      border-radius: 12px;
      margin-bottom: 40px;
      backdrop-filter: blur(10px);
    }

    .onboarding-tip-icon {
      font-size: 1.8rem;
    }

    .onboarding-tip-text {
      font-size: 1rem;
      font-weight: 500;
    }

    .onboarding-btn {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      border: none;
      padding: 18px 50px;
      font-size: 1.2rem;
      font-weight: 600;
      border-radius: 50px;
      cursor: pointer;
      letter-spacing: 2px;
      text-transform: uppercase;
      transition: transform 0.3s ease, box-shadow 0.3s ease;
      box-shadow: 0 10px 30px rgba(102, 126, 234, 0.4);
    }

    .onboarding-btn:hover {
      transform: translateY(-3px);
      box-shadow: 0 15px 40px rgba(102, 126, 234, 0.5);
    }

    .onboarding-btn:active {
      transform: translateY(-1px);
    }
  </style>
</head>

<body>

  <!-- –û–Ω–±–æ—Ä–¥–∏–Ω–≥ —ç–∫—Ä–∞–Ω -->
  <div id="onboarding-overlay">
    <div class="onboarding-content">
      <div class="onboarding-icon">üé≠</div>
      <div class="onboarding-title">–ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–π<br>–∞—É–¥–∏–æ-–≤–∏–∑—É–∞–ª—å–Ω—ã–π –æ–ø—ã—Ç</div>
      <div class="onboarding-description">
        –í–∞—Å –∂–¥—ë—Ç –ø–æ–≥—Ä—É–∂–µ–Ω–∏–µ –≤ –º–∏—Ä AR-–∏—Å–∫—É—Å—Å—Ç–≤–∞ —Å–æ –∑–≤—É–∫–æ–º –∏ –≤–∏–∑—É–∞–ª—å–Ω—ã–º–∏ —ç—Ñ—Ñ–µ–∫—Ç–∞–º–∏
      </div>
      <div class="onboarding-tip">
        <span class="onboarding-tip-icon">üéß</span>
        <span class="onboarding-tip-text">–í–∫–ª—é—á–∏—Ç–µ –∑–≤—É–∫ –∏–ª–∏ –Ω–∞–¥–µ–Ω—å—Ç–µ –Ω–∞—É—à–Ω–∏–∫–∏</span>
      </div>
      <button class="onboarding-btn" id="onboarding-btn">–î–∞–ª—å—à–µ</button>
    </div>
  </div>

  <!-- Loading Overlay -->
  <div id="loading-overlay" class="hidden">
    <div class="loading-content">
      <div class="loading-spinner"></div>
      <div class="loading-title">–ó–∞–≥—Ä—É–∑–∫–∞ –º–æ–¥–µ–ª–µ–π</div>
    </div>
  </div>

  <!-- –ü–ª–∞—à–∫–∞ "–ü–æ–π–º–∞–π –º–µ–Ω—è" -->
  <div id="catch-banner">–ü–æ–π–º–∞–π –º–µ–Ω—è</div>

  <!-- –ü–ª–∞—à–∫–∞ "–ù–∞—á–∞—Ç—å" –¥–ª—è –ø–µ—Ä–≤–æ–≥–æ –∑–∞–ø—É—Å–∫–∞ -->
  <div id="start-banner">–¢–∞–ø–Ω–∏ —á—Ç–æ–±—ã –Ω–∞—á–∞—Ç—å</div>

  <!-- A-Frame AR Scene -->
  <a-scene vr-mode-ui="enabled: false;" renderer="logarithmicDepthBuffer: true; precision: medium;" embedded
    arjs="trackingMethod: artoolkit; sourceType: webcam;" device-orientation-permission-ui="enabled: false">

    <!-- –ü—Ä–µ–¥–∑–∞–≥—Ä—É–∑–∫–∞ –≤—Å–µ—Ö –º–æ–¥–µ–ª–µ–π –∫–æ—Ç–æ–≤ –∏ –∞—É–¥–∏–æ -->
    <a-assets timeout="90000">

      <!-- –ú–æ–¥–µ–ª–∏ -->
      <a-asset-item id="lake-asset"
        src="assets/models/lake.glb"></a-asset-item>
      <a-asset-item id="cat-1-asset"
        src="assets/models/cat_1.glb"></a-asset-item>
      <a-asset-item id="cat-2-asset"
        src="assets/models/cat_2.glb"></a-asset-item>
      <a-asset-item id="cat-3-asset"
        src="assets/models/cat_3.glb"></a-asset-item>
      <!-- <a-asset-item id="cat-4-asset" src="assets/models/cat_4.glb"></a-asset-item>
      <a-asset-item id="cat-6-asset" src="assets/models/cat_6.glb"></a-asset-item>
      <a-asset-item id="cat-8-asset" src="assets/models/cat_8.glb"></a-asset-item>
      <a-asset-item id="cat-9-asset" src="assets/models/cat_9.glb"></a-asset-item>
      <a-asset-item id="cat-10-asset" src="assets/models/cat_10.glb"></a-asset-item> -->
<!-- –ê—É–¥–∏–æ -->
<audio id="cat-1-audio" src="assets/audios/cat_1.wav"
  preload="auto"></audio>
<audio id="cat-2-audio" src="assets/audios/cat_2.wav"
  preload="auto"></audio>
<audio id="cat-3-audio" src="assets/audios/cat_3.wav"
  preload="auto"></audio>
<!-- <audio id="cat-4-audio" src="assets/audios/cat_4.wav" preload="auto"></audio>
      <audio id="cat-6-audio" src="assets/audios/cat_6.wav" preload="auto"></audio>
      <audio id="cat-8-audio" src="assets/audios/cat_8.wav" preload="auto"></audio>
      <audio id="cat-9-audio" src="assets/audios/cat_9.wav" preload="auto"></audio>
      <audio id="cat-10-audio" src="assets/audios/cat_10.wav" preload="auto"></audio> -->
    </a-assets>

    <a-marker type="pattern" url="assets/markers/hole.patt" smooth="true" smoothCount="5" smoothTolerance=".1">
      <a-box id="box" position="0 0.5 0" rotation="0 0 0" scale="1 1 1"
        material="color: red; opacity: 0.5; transparent: true"></a-box>

      <!-- –ú–æ–¥–µ–ª—å –∫–æ—Ç–∞, –∫–æ—Ç–æ—Ä–∞—è –±—É–¥–µ—Ç –º–µ–Ω—è—Ç—å—Å—è –ø–æ –∫–ª–∏–∫—É -->
      <a-entity id="cat-model" gltf-model="#cat-1-asset" scale="1 1 1" position="0 0.5 0" rotation="0 0 0">
      </a-entity>
    </a-marker>

    <a-entity camera></a-entity>
  </a-scene>

  <script>
    const onboardingOverlay = document.getElementById('onboarding-overlay');
    const onboardingBtn = document.getElementById('onboarding-btn');
    const loadingOverlay = document.getElementById('loading-overlay');
    const catchBanner = document.getElementById('catch-banner');
    const startBanner = document.getElementById('start-banner');

    // –°–æ—Å—Ç–æ—è–Ω–∏–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
    let isAudioPlaying = false;
    let canCatch = false;
    let currentSceneIndex = 0;
    let isMarkerVisible = false;
    let isSceneReady = false;
    let isSceneLoaded = false; // –§–ª–∞–≥ –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ü–µ–Ω—ã (–¥–ª—è –æ–Ω–±–æ—Ä–¥–∏–Ω–≥–∞)
    let hasStartedFirstAudio = false; // –û—Ç—Å–ª–µ–∂–∏–≤–∞–µ–º, –∑–∞–ø—É—Å—Ç–∏–ª–∏ –ª–∏ –ø–µ—Ä–≤–æ–µ –∞—É–¥–∏–æ
    let waitingForFirstTap = false; // –ñ–¥—ë–º –ø–µ—Ä–≤—ã–π —Ç–∞–ø –¥–ª—è –∑–∞–ø—É—Å–∫–∞ –∞—É–¥–∏–æ
    let shouldShowBannerWhenMarkerVisible = false; // –§–ª–∞–≥ –¥–ª—è –æ—Ç–ª–æ–∂–µ–Ω–Ω–æ–≥–æ –ø–æ–∫–∞–∑–∞ –ø–ª–∞—à–∫–∏

    // –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —Å—Ü–µ–Ω —Å –∫–æ—Ç–∞–º–∏
      // –ö–∞–∂–¥–∞—è —Å—Ü–µ–Ω–∞: –º–æ–¥–µ–ª—å + –ø–æ–∑–∏—Ü–∏—è + –ø–æ–≤–æ—Ä–æ—Ç + –º–∞—Å—à—Ç–∞–± + –∞—É–¥–∏–æ (ID –ø—Ä–µ–¥–∑–∞–≥—Ä—É–∂–µ–Ω–Ω–æ–≥–æ —ç–ª–µ–º–µ–Ω—Ç–∞)
    const catScenes = [
      { model: '#cat-1-asset', position: '0 0.5 0', rotation: '0 0 0', scale: '1 1 1', audioId: 'cat-1-audio' },
      { model: '#cat-2-asset', position: '0 0.5 0', rotation: '0 0 0', scale: '1 1 1', audioId: 'cat-2-audio' },
      { model: '#cat-3-asset', position: '0 0.5 0', rotation: '0 0 0', scale: '1 1 1', audioId: 'cat-3-audio' },
      // { model: '#cat-4-asset', position: '0 0.5 0', rotation: '0 0 0', scale: '1 1 1', audioId: 'cat-4-audio' },
      // { model: '#cat-6-asset', position: '0 0.5 0', rotation: '0 0 0', scale: '1 1 1', audioId: 'cat-6-audio' },
      // { model: '#cat-8-asset', position: '0 0.5 0', rotation: '0 0 0', scale: '1 1 1', audioId: 'cat-8-audio' },
      // { model: '#cat-9-asset', position: '0 0.5 0', rotation: '0 0 0', scale: '1 1 1', audioId: 'cat-9-audio' },
      // { model: '#cat-10-asset', position: '0 0.5 0', rotation: '0 0 0', scale: '1 1 1', audioId: 'cat-10-audio' },
    ];

    // –¢–µ–∫—É—â–∏–π –∞—É–¥–∏–æ –æ–±—ä–µ–∫—Ç
    let currentAudio = null;

    // –ü–æ–∫–∞–∑–∞—Ç—å –ø–ª–∞—à–∫—É "–ù–∞—á–∞—Ç—å" (–¥–ª—è –ø–µ—Ä–≤–æ–≥–æ –∑–∞–ø—É—Å–∫–∞)
    function showStartBanner() {
      if (isMarkerVisible) {
        waitingForFirstTap = true;
        startBanner.classList.add('visible');
      }
    }

    // –°–∫—Ä—ã—Ç—å –ø–ª–∞—à–∫—É "–ù–∞—á–∞—Ç—å"
    function hideStartBanner() {
      waitingForFirstTap = false;
      startBanner.classList.remove('visible');
    }

    // –ü–æ–∫–∞–∑–∞—Ç—å –ø–ª–∞—à–∫—É "–ü–æ–π–º–∞–π –º–µ–Ω—è" (—Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –º–∞—Ä–∫–µ—Ä –≤–∏–¥–µ–Ω)
    function showCatchBanner() {
      if (isMarkerVisible) {
        canCatch = true;
        catchBanner.classList.add('visible');
        shouldShowBannerWhenMarkerVisible = false;
      } else {
        // –ó–∞–ø–æ–º–∏–Ω–∞–µ–º, —á—Ç–æ –Ω—É–∂–Ω–æ –ø–æ–∫–∞–∑–∞—Ç—å –ø–ª–∞—à–∫—É –∫–æ–≥–¥–∞ –º–∞—Ä–∫–µ—Ä –ø–æ—è–≤–∏—Ç—Å—è
        shouldShowBannerWhenMarkerVisible = true;
      }
    }

    // –°–∫—Ä—ã—Ç—å –ø–ª–∞—à–∫—É "–ü–æ–π–º–∞–π –º–µ–Ω—è"
    function hideCatchBanner() {
      canCatch = false;
      catchBanner.classList.remove('visible');
    }

    // –ó–∞–ø—É—Å—Ç–∏—Ç—å –∞—É–¥–∏–æ –¥–ª—è —Ç–µ–∫—É—â–µ–π —Å—Ü–µ–Ω—ã
    function playSceneAudio() {
      const scene = catScenes[currentSceneIndex];

      // –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –ø—Ä–µ–¥—ã–¥—É—â–µ–µ –∞—É–¥–∏–æ –µ—Å–ª–∏ –µ—Å—Ç—å
      if (currentAudio) {
        currentAudio.pause();
        currentAudio.currentTime = 0; // –°–±—Ä–∞—Å—ã–≤–∞–µ–º –ø–æ–∑–∏—Ü–∏—é –¥–ª—è –ø–æ–≤—Ç–æ—Ä–Ω–æ–≥–æ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è
        // –£–±–∏—Ä–∞–µ–º —Å—Ç–∞—Ä—ã–π –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ ended
        currentAudio.removeEventListener('ended', onAudioEnded);
      }

      isAudioPlaying = true;
      hideCatchBanner();
      shouldShowBannerWhenMarkerVisible = false;

      // –ò—Å–ø–æ–ª—å–∑—É–µ–º –ø—Ä–µ–¥–∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã–π –∞—É–¥–∏–æ —ç–ª–µ–º–µ–Ω—Ç
      currentAudio = document.getElementById(scene.audioId);

      if (!currentAudio) {
        console.warn('Audio element not found:', scene.audioId);
        isAudioPlaying = false;
        showCatchBanner();
        return;
      }

      // –°–±—Ä–∞—Å—ã–≤–∞–µ–º –ø–æ–∑–∏—Ü–∏—é –Ω–∞ –Ω–∞—á–∞–ª–æ
      currentAudio.currentTime = 0;

      // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –æ–∫–æ–Ω—á–∞–Ω–∏—è
      currentAudio.addEventListener('ended', onAudioEnded);

      currentAudio.play().catch(function (err) {
        console.warn('Could not play audio:', err);
        isAudioPlaying = false;
        showCatchBanner();
      });

          console.log('Playing audio:', scene.audioId);
        }

        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –æ–∫–æ–Ω—á–∞–Ω–∏—è –∞—É–¥–∏–æ (–≤—ã–Ω–µ—Å–µ–Ω –æ—Ç–¥–µ–ª—å–Ω–æ –¥–ª—è –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ —É–¥–∞–ª–µ–Ω–∏—è)
        function onAudioEnded() {
          isAudioPlaying = false;
          showCatchBanner();
          console.log('Audio ended, catch mode activated!');
    }

    // –§—É–Ω–∫—Ü–∏—è —Å–º–µ–Ω—ã —Å—Ü–µ–Ω—ã
    function switchToNextScene() {
      const box = document.getElementById('box');
      const currentColor = box.getAttribute('material').color;
      const newColor = currentColor === 'red' ? 'blue' : 'red';
      box.setAttribute('material', 'color: ' + newColor);

      const catModel = document.getElementById('cat-model');
      if (!catModel) return;

      currentSceneIndex = (currentSceneIndex + 1) % catScenes.length;
      const scene = catScenes[currentSceneIndex];

      catModel.setAttribute('gltf-model', scene.model);
      catModel.setAttribute('position', scene.position);
      catModel.setAttribute('rotation', scene.rotation);
      catModel.setAttribute('scale', scene.scale);

      console.log('Switched to cat scene:', currentSceneIndex + 1, scene.model);

      // –ó–∞–ø—É—Å–∫–∞–µ–º –∞—É–¥–∏–æ –¥–ª—è –Ω–æ–≤–æ–π —Å—Ü–µ–Ω—ã
      playSceneAudio();
    }

    // –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–ª–∏–∫–∞/—Ç–∞–ø–∞
    function handleInteraction(e) {
      // –ò–≥–Ω–æ—Ä–∏—Ä—É–µ–º –∫–ª–∏–∫–∏ –µ—Å–ª–∏ –º–∞—Ä–∫–µ—Ä –Ω–µ –≤–∏–¥–µ–Ω
      if (!isMarkerVisible) {
        console.log('Marker not visible, ignoring click');
        return;
      }

      // –ï—Å–ª–∏ –∂–¥—ë–º –ø–µ—Ä–≤—ã–π —Ç–∞–ø –¥–ª—è –∑–∞–ø—É—Å–∫–∞ ‚Äî –∑–∞–ø—É—Å–∫–∞–µ–º –ø–µ—Ä–≤–æ–µ –∞—É–¥–∏–æ
      if (waitingForFirstTap) {
        console.log('First tap received, starting audio!');
        hideStartBanner();
        hasStartedFirstAudio = true;
        playSceneAudio();
        return;
      }

      // –ò–≥–Ω–æ—Ä–∏—Ä—É–µ–º –∫–ª–∏–∫–∏ –ø–æ–∫–∞ –∞—É–¥–∏–æ –∏–≥—Ä–∞–µ—Ç
      if (isAudioPlaying) {
        console.log('Audio is playing, ignoring click');
        return;
      }

      // –ò–≥–Ω–æ—Ä–∏—Ä—É–µ–º –µ—Å–ª–∏ –µ—â—ë –Ω–µ –º–æ–∂–µ–º –ª–æ–≤–∏—Ç—å
      if (!canCatch) {
        console.log('Catch mode not active yet');
        return;
      }

      // –°–∫—Ä—ã–≤–∞–µ–º –ø–ª–∞—à–∫—É –∏ –ø–µ—Ä–µ–∫–ª—é—á–∞–µ–º —Å—Ü–µ–Ω—É
      hideCatchBanner();
      switchToNextScene();
    }

    // –û–±—Ä–∞–±–æ—Ç–∫–∞ –ø–æ—è–≤–ª–µ–Ω–∏—è –º–∞—Ä–∫–µ—Ä–∞
    function onMarkerFound() {
      console.log('Marker found!');
      isMarkerVisible = true;

      // –ï—Å–ª–∏ —Å—Ü–µ–Ω–∞ –≥–æ—Ç–æ–≤–∞ –∏ –µ—â—ë –Ω–µ –∑–∞–ø—É—Å–∫–∞–ª–∏ –ø–µ—Ä–≤–æ–µ –∞—É–¥–∏–æ ‚Äî –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–ª–∞—à–∫—É "–ù–∞—á–∞—Ç—å"
      if (isSceneReady && !hasStartedFirstAudio && !waitingForFirstTap) {
        showStartBanner();
      }

      // –ï—Å–ª–∏ –∂–¥–∞–ª–∏ –ø–µ—Ä–≤—ã–π —Ç–∞–ø –∏ –º–∞—Ä–∫–µ—Ä –≤–µ—Ä–Ω—É–ª—Å—è ‚Äî –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–ª–∞—à–∫—É —Å–Ω–æ–≤–∞
      if (!hasStartedFirstAudio && waitingForFirstTap) {
        startBanner.classList.add('visible');
      }

      // –ï—Å–ª–∏ –Ω—É–∂–Ω–æ –ø–æ–∫–∞–∑–∞—Ç—å –ø–ª–∞—à–∫—É "–ü–æ–π–º–∞–π –º–µ–Ω—è" (–∞—É–¥–∏–æ –∑–∞–∫–æ–Ω—á–∏–ª–æ—Å—å –ø–æ–∫–∞ –º–∞—Ä–∫–µ—Ä –±—ã–ª —Å–∫—Ä—ã—Ç)
      if (shouldShowBannerWhenMarkerVisible && !isAudioPlaying && hasStartedFirstAudio) {
        showCatchBanner();
      }
    }

    // –û–±—Ä–∞–±–æ—Ç–∫–∞ –ø–æ—Ç–µ—Ä–∏ –º–∞—Ä–∫–µ—Ä–∞
    function onMarkerLost() {
      console.log('Marker lost!');
      isMarkerVisible = false;

      // –°–∫—Ä—ã–≤–∞–µ–º –ø–ª–∞—à–∫—É "–ù–∞—á–∞—Ç—å" –∫–æ–≥–¥–∞ –º–∞—Ä–∫–µ—Ä –ø–æ—Ç–µ—Ä—è–Ω
      if (waitingForFirstTap) {
        startBanner.classList.remove('visible');
      }

      // –°–∫—Ä—ã–≤–∞–µ–º –ø–ª–∞—à–∫—É "–ü–æ–π–º–∞–π –º–µ–Ω—è" –∫–æ–≥–¥–∞ –º–∞—Ä–∫–µ—Ä –ø–æ—Ç–µ—Ä—è–Ω
      if (canCatch) {
        hideCatchBanner();
        // –ó–∞–ø–æ–º–∏–Ω–∞–µ–º, —á—Ç–æ –ø–ª–∞—à–∫—É –Ω—É–∂–Ω–æ –ø–æ–∫–∞–∑–∞—Ç—å –∫–æ–≥–¥–∞ –º–∞—Ä–∫–µ—Ä –≤–µ—Ä–Ω—ë—Ç—Å—è
        shouldShowBannerWhenMarkerVisible = true;
      }
    }

    // –û–Ω–±–æ—Ä–¥–∏–Ω–≥: –∫–Ω–æ–ø–∫–∞ "–î–∞–ª—å—à–µ"
    onboardingBtn.addEventListener('click', function () {
      onboardingOverlay.classList.add('hidden');

      // –ï—Å–ª–∏ —Å—Ü–µ–Ω–∞ —É–∂–µ –∑–∞–≥—Ä—É–∂–µ–Ω–∞ ‚Äî —Å—Ä–∞–∑—É —Å–∫—Ä—ã–≤–∞–µ–º –ª–æ–∞–¥–µ—Ä
      if (isSceneLoaded) {
        loadingOverlay.classList.add('hidden');
        isSceneReady = true;
        console.log('Scene already loaded, ready!');
      } else {
        // –ò–Ω–∞—á–µ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –ª–æ–∞–¥–µ—Ä –∏ –∂–¥—ë–º –∑–∞–≥—Ä—É–∑–∫–∏
        loadingOverlay.classList.remove('hidden');
      }
    });

    // –°–∫—Ä—ã—Ç—å –ª–æ–∞–¥–µ—Ä –∫–æ–≥–¥–∞ —Å—Ü–µ–Ω–∞ –∑–∞–≥—Ä—É–∂–µ–Ω–∞
    document.querySelector('a-scene').addEventListener('loaded', function () {
      console.log('Scene loaded event fired');
      isSceneLoaded = true;

      // –ü–æ–¥–ø–∏—Å—ã–≤–∞–µ–º—Å—è –Ω–∞ —Å–æ–±—ã—Ç–∏—è –º–∞—Ä–∫–µ—Ä–∞
      const marker = document.querySelector('a-marker');
      if (marker) {
        marker.addEventListener('markerFound', onMarkerFound);
        marker.addEventListener('markerLost', onMarkerLost);
      }

      // –°–∫—Ä—ã–≤–∞–µ–º –ª–æ–∞–¥–µ—Ä —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –æ–Ω–±–æ—Ä–¥–∏–Ω–≥ —É–∂–µ –ø—Ä–æ–π–¥–µ–Ω
      // (–µ—Å–ª–∏ –æ–Ω–±–æ—Ä–¥–∏–Ω–≥ –µ—â—ë –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è, hidden –∫–ª–∞—Å—Å —É–∂–µ —Å—Ç–æ–∏—Ç –Ω–∞ –ª–æ–∞–¥–µ—Ä–µ)
      setTimeout(() => {
        loadingOverlay.classList.add('hidden');
        isSceneReady = true;
        console.log('Scene ready, waiting for marker...');
      }, 300);
    });

    // –ö–ª–∏–∫/—Ç–∞–ø –Ω–∞ —ç–∫—Ä–∞–Ω ‚Äî –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —Å—Ü–µ–Ω—ã (–µ—Å–ª–∏ —Ä–∞–∑—Ä–µ—à–µ–Ω–æ)
    document.addEventListener('DOMContentLoaded', function () {
      window.addEventListener('click', handleInteraction);
      window.addEventListener('touchstart', handleInteraction, { passive: true });
    });
  </script>

</body>

</html>
